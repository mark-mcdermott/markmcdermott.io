---
import { getCollection, render } from 'astro:content';
import DefaultLayout from '../../layouts/DefaultLayout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.data.slug ?? post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

function formatDate(dateStr: string) {
  return new Date(dateStr + 'T00:00:00').toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
}
---

<DefaultLayout pageTitle={post.data.title} headerClass="page-header--meta">
  <Fragment slot="header-meta">
    {post.data.subtitle && <p class="subtitle">{post.data.subtitle}</p>}
    <time datetime={post.data.date}>{formatDate(post.data.date)}</time>
  </Fragment>
  <article>
    <Content />
  </article>
</DefaultLayout>

<style lang="scss">
  @use '../../styles/abstracts' as *;

  .subtitle,
  time {
    @include terminal-output;
    font-size: $font-size-xs;
    line-height: 1.2;
    margin: 0;
  }

  .subtitle {
    margin-top: $spacing-unit * 0.5;
  }

  time {
    display: block;
    margin-top: 2px;
  }

  article {
    padding-bottom: $spacing-unit * 4;

    :global(p) {
      line-height: $line-height-base;
      letter-spacing: $letter-spacing-body;
      margin-bottom: $spacing-unit * 2.5;
    }
  }
</style>
