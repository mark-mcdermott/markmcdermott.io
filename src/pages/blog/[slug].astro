---
import { getCollection, render } from 'astro:content';
import DefaultLayout from '../../layouts/DefaultLayout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.data.slug ?? post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

function formatDate(dateStr: string) {
  return new Date(dateStr + 'T00:00:00').toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
}
---

<DefaultLayout>
  <article>
    <header>
      <h1>{post.data.title}</h1>
      {post.data.subtitle && <p class="subtitle">{post.data.subtitle}</p>}
      <time datetime={post.data.date}>{formatDate(post.data.date)}</time>
    </header>
    <Content />
  </article>
</DefaultLayout>

<style lang="scss">
  @use '../../styles/abstracts' as *;

  article {
    margin-top: $spacing-unit * 4;
    padding-bottom: $spacing-unit * 4;

    header {
      padding-bottom: $spacing-unit * 2.75;
      margin-bottom: $spacing-unit * 3;
      @include terminal-output;
      @include hyphen-border(bottom);

      h1 {
        font-size: 1.5rem;
        margin: 0 0 ($spacing-unit * 0.25);
        letter-spacing: -0.03em;
        word-spacing: -0.3em;
        line-height: $line-height-base * 0.95;
      }

      .subtitle {
        margin: 0 0 ($spacing-unit * 0.5);
      }
    }

    :global(p) {
      line-height: $line-height-base;
      letter-spacing: $letter-spacing-body;
      margin-bottom: $spacing-unit * 2.5;
    }
  }
</style>
