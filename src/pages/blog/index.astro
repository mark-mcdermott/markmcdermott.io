---
import { getCollection } from 'astro:content';
import DefaultLayout from '../../layouts/DefaultLayout.astro';

const posts = (await getCollection('blog')).sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

function formatDate(dateStr: string) {
  return new Date(dateStr + 'T00:00:00').toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
}
---

<DefaultLayout>
  <h1>Blog</h1>

  <section>
    <ul class="post-list">
      {posts.map((post) => (
        <li>
          <a href={`/blog/${post.data.slug ?? post.id}`}>
            <time datetime={post.data.date}>{formatDate(post.data.date)}</time>
            <span>{post.data.title}</span>
          </a>
        </li>
      ))}
    </ul>
  </section>
</DefaultLayout>

<style lang="scss">
  @use '../../styles/abstracts' as *;

  h1 {
    font-size: 2rem;
    margin: 0 0 ($spacing-unit * 2);
    letter-spacing: -0.03em;
    word-spacing: -0.3em;
    line-height: $line-height-base * 0.95;
  }

  .post-list {
    list-style: none;
    padding: 0;
    margin: 0;
    @include hyphen-border(top);

    &:has(li:first-child:hover) {
      background-image: repeating-linear-gradient(
        to right,
        var(--color-link) 0,
        var(--color-link) 10px,
        transparent 10px,
        transparent 12px
      );
    }

    li {
      @include hyphen-border(bottom);

      &:hover {
        --color-text: var(--color-link);
      }

      &:has(+ li:hover) {
        background-image: repeating-linear-gradient(
          to right,
          var(--color-link) 0,
          var(--color-link) 10px,
          transparent 10px,
          transparent 12px
        );
      }
    }

    a {
      display: flex;
      align-items: baseline;
      gap: $spacing-unit * 3;
      padding: ($spacing-unit * 1.5) 0;
      color: var(--color-text);
      text-decoration: none;

      span {
        font-weight: 500;
      }
    }

    time {
      @include terminal-output;
      font-size: 0.75rem;
      flex-shrink: 0;
      width: 9em;
    }
  }

