---
import type { GetStaticPaths } from 'astro';
import { getCollection } from 'astro:content';
import DefaultLayout from '../../layouts/DefaultLayout.astro';

export const getStaticPaths = (async ({ paginate }) => {
  const posts = (await getCollection('blog')).sort(
    (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
  );
  return paginate(posts, { pageSize: 15 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;

function formatDate(dateStr: string) {
  return new Date(dateStr + 'T00:00:00').toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: '2-digit',
  });
}
---

<DefaultLayout>
  <h1>Blog</h1>

  <section>
    <ul class="post-list">
      {page.data.map((post) => (
        <li>
          <a href={`/blog/${post.data.slug ?? post.id}`}>
            <time datetime={post.data.date}>{formatDate(post.data.date)}</time>
            <span>{post.data.title}</span>
          </a>
        </li>
      ))}
    </ul>

    {page.lastPage > 1 && (
      <nav class="pagination">
        {page.url.prev ? (
          <a href={page.url.prev} class="pagination__link">&larr; Prev</a>
        ) : (
          <span class="pagination__link pagination__link--disabled">&larr; Prev</span>
        )}
        <span class="pagination__info">Page {page.currentPage} of {page.lastPage}</span>
        {page.url.next ? (
          <a href={page.url.next} class="pagination__link">Next &rarr;</a>
        ) : (
          <span class="pagination__link pagination__link--disabled">Next &rarr;</span>
        )}
      </nav>
    )}
  </section>
</DefaultLayout>

<style lang="scss">
  @use '../../styles/abstracts' as *;

  h1 {
    font-size: $font-size-xl;
    margin: 0 0 ($spacing-unit * 2);
    letter-spacing: -0.03em;
    word-spacing: -0.3em;
    line-height: $line-height-base * 0.95;
  }

  .post-list {
    margin-bottom: $spacing-unit * 4;
    list-style: none;
    padding: 0;
    @include hyphen-border(top);

    &:has(li:first-child:hover) {
      @include hyphen-border-hover;
    }

    li {
      @include hyphen-border(bottom);

      &:hover {
        --color-text: var(--color-link);
      }

      &:has(+ li:hover) {
        @include hyphen-border-hover;
      }
    }

    a {
      display: flex;
      align-items: baseline;
      gap: $spacing-unit * 3;
      padding: ($spacing-unit * 1.5) 0;
      color: var(--color-text);
      text-decoration: none;

      span {
        font-weight: 500;
      }
    }

    time {
      @include terminal-output;
      font-size: $font-size-xs;
      flex-shrink: 0;
      width: 9em;
    }
  }

  .pagination {
    display: flex;
    justify-content: center;
    gap: $spacing-unit * 4;
    align-items: center;
    margin-bottom: $spacing-unit * 15;

    &__link {
      @include terminal-output;
      font-size: $font-size-xs;
      color: var(--color-link);
      text-decoration: none;

      &:hover {
        color: var(--color-link-hover);
      }

      &--disabled {
        color: var(--color-text);
        opacity: $opacity-disabled;
      }
    }

    &__info {
      @include terminal-output;
      font-size: $font-size-xs;
    }
  }

