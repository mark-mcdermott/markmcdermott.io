---
import { getCollection } from 'astro:content';
import DefaultLayout from '../layouts/DefaultLayout.astro';
import WeatherIcon from '../components/WeatherIcon.astro';
import ProjectsGrid from '../components/ProjectsGrid.astro';

const posts = (await getCollection('blog')).sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

function formatDate(dateStr: string) {
  return new Date(dateStr + 'T00:00:00').toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: '2-digit',
  });
}

const projects = [
  {
    name: 'markmcdermott.io',
    description: 'My portfolio site and dev blog (clean with a dash of C-64 aesthetic).',
    repo: 'mark-mcdermott/markmcdermott.io',
    url: 'https://github.com/mark-mcdermott/markmcdermott.io',
  },
  {
    name: 'puravida',
    description: 'One-liner for mkdir, touch and multiline insertion. Been using this for years.',
    repo: 'mark-mcdermott/puravida',
    url: 'https://github.com/mark-mcdermott/puravida',
  },
]
---

<DefaultLayout>
  <section class="hero">
    <div class="hero__intro">
      <p class="hero__meta">
        <span class="hero__clock"></span>&nbsp;&middot; austin, tx <WeatherIcon />
      </p>
      <h1><svg class="emoji" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 728 800" fill="currentColor"><polygon points="655 0 655.15 36.25 546.01 36.25 546 0 655 0"/><polygon points="728 72.8 728 181.8 691.64 181.72 691.66 72.81 728 72.8"/><rect x="527.83" y="54.78" width="36.11" height="72.41" transform="translate(454.67 636.84) rotate(-89.98)"/><rect x="655.04" y="36.45" width="36.42" height="36.31" transform="translate(-.11 1.41) rotate(-.12)"/><rect x="582.42" y="109.26" width="36.02" height="36.02"/><polygon points="0 618 0 509 36.19 509.38 36.18 618.11 0 618"/><polygon points="582.06 800 509.72 800 509.76 763.9 582.05 763.9 582.06 800"/><polygon points="728 618.41 728 654.15 691.67 654.43 691.65 618.46 728 618.41"/><polygon points="473.22 327.16 436.93 327.04 436.9 291.07 473.12 290.99 473.13 182.08 509.2 182.01 509.2 363.41 473.26 363.37 473.22 327.16"/><rect x="582.38" y="327.56" width="36.1" height="181.44"/><rect x="546" y="182" width="36.09" height="145.12"/><rect x="73" y="654.84" width="109" height="36.09"/><polygon points="218.05 254.91 218.12 290.81 145.87 290.79 145.88 218.37 181.72 218.39 181.84 254.76 218.05 254.91"/><polygon points="181.59 327.65 181.91 363.38 109.37 363.41 109.29 291.17 145.27 290.98 145.32 327.51 181.59 327.65"/><polygon points="691.22 618.01 655.2 618.06 655.15 581.69 618.87 581.64 618.87 509.19 654.94 509.18 655.04 582.06 691.19 581.97 691.22 618.01"/><rect x="182" y="182" width="72.5" height="36.06"/><rect x="618.84" y="145.76" width="36.16" height="72.35"/><rect x="382.17" y="636.68" width="36.08" height="72.43" transform="translate(-272.8 1072.93) rotate(-89.98)"/><rect x="73" y="472.94" width="36.07" height="72.4"/><rect x="273.13" y="127.57" width="36.02" height="72.38" transform="translate(127.34 454.88) rotate(-89.99)"/><rect x="145.81" y="582" width="72.37" height="36.11"/><polygon points="327.3 508.99 291.31 508.97 291.33 472.62 255.05 472.61 254.93 436.7 291.01 436.68 290.98 473.02 327.26 472.99 327.3 508.99"/><polygon points="400.12 254.26 363.99 254.35 364.05 218.05 327.82 218 327.79 181.99 363.86 182.03 363.91 218.37 400.07 218.46 400.12 254.26"/><rect x="291.29" y="254.87" width="35.97" height="35.95"/><polygon points="654.99 727.07 618.87 727.1 618.88 691.06 655.18 691.05 655.19 654.87 691.16 654.86 691.17 690.95 654.91 690.86 654.99 727.07"/><rect x="327.85" y="290.95" width="36.1" height="36.21" transform="translate(36.7 654.83) rotate(-89.98)"/><polygon points="473.01 727.09 436.92 727.14 436.94 691.09 472.8 691.05 473.01 727.09"/><rect x="73" y="363.9" width="36.05" height="36.1"/><rect x="182" y="363.86" width="36.16" height="36.14"/><rect x="291.24" y="363.91" width="36.09" height="36.09"/><rect x="327.72" y="400" width="36.15" height="36.13"/><rect x="182" y="472.94" width="36.13" height="36.08"/><polygon points="327.29 618.05 291.29 618.03 291.28 581.76 255 581.78 254.93 545.82 291.02 545.79 290.95 582.08 327.24 581.98 327.29 618.05"/><rect x="509.69" y="145.76" width="36.1" height="35.96"/><polygon points="181.78 472.63 145.89 472.71 145.87 436.66 181.72 436.67 181.78 472.63"/><rect x="109.35" y="545.73" width="36.01" height="36.13" transform="translate(-436.51 690.85) rotate(-89.97)"/><polygon points="145.33 436.11 109.28 436.13 109.44 400.26 145.33 400.09 145.33 436.11"/><polygon points="254.57 436.07 218.61 436.14 218.64 400.15 254.61 400.19 254.57 436.07"/><rect x="254.99" y="218.33" width="35.96" height="36.08" transform="translate(36.47 509.22) rotate(-89.97)"/><rect x="36.64" y="618.43" width="36.19" height="36.02"/><rect x="400.35" y="363.97" width="36.12" height="35.98" transform="translate(36.2 800.14) rotate(-89.97)"/><rect x="218.56" y="509.32" width="36.05" height="35.96" transform="translate(-290.8 763.67) rotate(-89.98)"/><rect x="327.76" y="618.43" width="36.06" height="35.99"/><rect x="218.63" y="291" width="35.93" height="36.09"/><polygon points="509.23 763.45 473.22 763.51 473.11 727.62 509.06 727.44 509.23 763.45"/><polygon points="436.48 290.81 400.52 290.81 400.49 254.91 436.47 254.87 436.48 290.81"/><rect x="364" y="327.58" width="36.06" height="35.81"/><rect x="254.94" y="327.54" width="36.06" height="35.91"/><rect x="582.44" y="727.54" width="36.06" height="35.96" transform="translate(-147.41 1343.05) rotate(-89.77)"/></svg> Hey, I'm Mark McDermott</h1>
      <p class="hero__bio">I'm a software engineer based in Austin, TX.</p>
      <p>I <a href="https://github.com/mark-mcdermott">code</a>, <a href="/blog">write</a> and work at <a href="https://www.doximity.com" target="_blank" rel="noopener">Doximity</a> doing QA.</p>
    </div>
    <div class="hero__photo">
      <img src="/images/headshot.png" alt="Mark McDermott" width="150" height="150" />
    </div>
  </section>

  <section class="writings">
    <div class="writings__header">
      <h2>Writings</h2>
      <a href="/blog" class="writings__view-all">View all &rarr;</a>
    </div>
    <ul class="writings__list">
      {posts.slice(0, 5).map((post) => (
        <li>
          <a href={`/blog/${post.data.slug ?? post.id}`}>
            <time datetime={post.data.date}>{formatDate(post.data.date)}</time>
            <span>{post.data.title}</span>
          </a>
        </li>
      ))}
    </ul>
  </section>

  <ProjectsGrid projects={projects} />

</DefaultLayout>

<style lang="scss">
  @use '../styles/abstracts' as *;

  .hero {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: $spacing-unit * 4;
    margin-top: $spacing-unit * 4;
  }

  .hero__intro {
    flex: 1;
  }

  .emoji {
    margin-right: 0.3em;
    height: 1.5em;
    width: auto;
    vertical-align: -0.3em;
    display: inline-block;
  }

  .hero__meta {
    @include c64-type;
    text-transform: lowercase;
    margin-bottom: $spacing-unit;
    display: flex;
    align-items: center;
    gap: 0.25em;
    word-spacing: -0.5em;
  }

  .hero h1 {
    font-size: $font-size-lg;
    margin: 0 0 ($spacing-unit * 2);
    letter-spacing: normal;
    word-spacing: normal;
    line-height: $line-height-base * 0.95;
  }

  .hero__bio {
    line-height: $line-height-base;
    letter-spacing: $letter-spacing-body;

    a {
      color: var(--color-text);
      text-decoration: underline;

      &:hover {
        color: var(--color-link-hover);
      }
    }
  }

  .hero__photo {
    flex-shrink: 0;
    width: 150px;
    height: 150px;
    border-radius: 50%;
    overflow: hidden;
    position: relative;
    right: 30px;

    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: grayscale(100%) contrast(1.8) brightness(1.05);
    }

    &::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 50%;
      background: repeating-linear-gradient(
        to bottom,
        transparent 0px,
        transparent 2px,
        rgba(0, 0, 0, 0) 2px,
        rgba(0, 0, 0, 0.5) 4px
      );
      pointer-events: none;
      opacity: $opacity-overlay;
    }
  }

  .writings {
    margin-top: $spacing-unit * 1;
    padding-top: $spacing-unit * 3;
    padding-bottom: $spacing-unit * 4;
  }

  .writings__header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: $spacing-unit * 2;

    h2 {
      font-size: $font-size-md;
      letter-spacing: normal;
      word-spacing: normal;
      line-height: $line-height-base * 0.8;
      margin: 0;
    }
  }

  .writings__view-all {
    @include c64-type;
    font-size: $font-size-xs;
    color: var(--color-text);
    text-decoration: none;
    letter-spacing: 0;

    &:hover {
      color: var(--color-link);
    }
  }

  .writings__list {
    @include post-list;
    margin: 0;
  }

  :global([data-theme='c64']) .hero__photo img {
    filter: grayscale(100%) sepia(100%) hue-rotate(180deg) saturate(2) brightness(1.1);
  }

  @include mobile {
    .hero {
      margin-top: 0;
      flex-direction: column-reverse;
      align-items: center;
      text-align: center;
    }

    .hero__photo {
      width: 200px;
      height: 200px;
      right: 0;
    }
  }
</style>

<script>
  const clock = document.querySelector('.hero__clock');
  function updateClock() {
    const now = new Date();
    const h = String(now.getHours()).padStart(2, '0');
    const m = String(now.getMinutes()).padStart(2, '0');
    const s = String(now.getSeconds()).padStart(2, '0');
    if (clock) clock.textContent = `${h}:${m}:${s}`;
  }
  updateClock();
  setInterval(updateClock, 1000);
</script>
